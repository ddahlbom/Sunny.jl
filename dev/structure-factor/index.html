<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Structure Factor Calculations Â· SU(N) Spin Simulations</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="SU(N) Spin Simulations logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">SU(N) Spin Simulations</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Sunny.jl</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../library/">Library</a></li><li class="is-active"><a class="tocitem" href>Structure Factor Calculations</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#High-level-functions"><span>High-level functions</span></a></li><li><a class="tocitem" href="#Manual-incremental-updates"><span>Manual incremental updates</span></a></li></ul></li><li><a class="tocitem" href="../internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Structure Factor Calculations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Structure Factor Calculations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/MagSims/Sunny.jl/blob/master/docs/src/structure-factor.md" title="Edit on GitHub"><span class="docs-icon fab">ï‚›</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Structure-Factor-Calculations"><a class="docs-heading-anchor" href="#Structure-Factor-Calculations">Structure Factor Calculations</a><a id="Structure-Factor-Calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-Factor-Calculations" title="Permalink"></a></h1><p>(Still under-complete.)</p><p>This page gives information on the static and dynamical spin structure factors, how to use Sunny&#39;s high and low-level interfaces for computing it, and what is happening behind the scenes in these functions!</p><p>The central type implementing all of the computation behind the scenes is <a href="../library/#Sunny.StructureFactor"><code>StructureFactor</code></a>.</p><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>The structure factor is one representation in which to examine how spins are correlated within spin configurations sampled from the thermal spin distribution defined by the system&#39;s Hamiltonian. Specifically, we will write our spin degrees of freedom as <span>$S^Î±_j(ğ«, t)$</span>, where <span>$ğ« = n_a ğš + n_b ğ› + n_c ğœ$</span> is the coordinate of the unit cell, <span>$t$</span> is the time during some evolved dynamics, <span>$j$</span> is the index into the basis/sublattice within the unit cell, and <span>$Î± = \{x,y,z\}$</span> is the spin-component index.</p><p>Spin-spin correlations in real space and time can be characterized by the two-point correlation function:</p><p class="math-container">\[C^{Î±Î²}_{jk}(ğ«, t) = âŸ¨S^Î±_j(ğ«_0, t_0) S^Î²_k(ğ«_0 + ğ«, t_0 + t)âŸ©_{ğ«_0, t_0}\]</p><p>where <span>$âŸ¨â‹…âŸ©_{ğ«_0, t_0}$</span> means we are taking a thermal average over different spin configurations, as well as an average over reference positions <span>$ğ«_0$</span> in the lattice and times <span>$t_0$</span> in the dynamics. Colloquially, this function is telling us &quot;how much is the <span>$S^Î±$</span> component of one spin on sublattice <span>$j$</span> correlated with the <span>$S^Î²$</span> component of another spin on sublattice <span>$k$</span> which is displaced in position and time by <span>$(ğ«, t)$</span>?&quot;.</p><p>The full <em>dynamic structure factor</em> is the Fourier transform of the two-point correlation function.</p><p class="math-container">\[ğ’®^{Î±Î²}_{jk}(ğª, Ï‰) = \frac{1}{\sqrt{2Ï€}} \sum_ğ« \int dt e^{-i (ğª â‹… ğ« + Ï‰t)} C^{Î±Î²}_{jk}(ğ«, t)\]</p><p>This is the quantity which the structure factor module computes. By explicitly performing the spatial/time averages in our definition of the two-point correlation function, we can obtain an alternate, more easily calculable form for the dynamic structure factor:</p><p class="math-container">\[ğ’®^{Î±Î²}_{jk}(ğª, Ï‰) = âŸ¨S^Î±_j(ğª, Ï‰) S^Î²_k(ğª, Ï‰)^âˆ—âŸ©\]</p><p>where <span>$^âˆ—$</span> refers to complex conjugation. This provides an easy direct route to calculating the dynamic structure factor:</p><ol><li>Obtain a bunch of thermal spin configurations <span>$S^Î±_j(ğ«)$</span></li><li>Using these as initial conditions, time evolve them all forward using Landau-Lifshitz  dynamics to obtain <span>$S^Î±_j(ğ«, t)$</span>.</li><li>Discrete Fourier transform them all to obtain <span>$S^Î±_j(ğª, Ï‰)$</span></li><li>Perform a complex-conjugated outer product to obtain a contribution <span>$S^Î±_j(ğª, Ï‰)S^Î²_k(ğª, Ï‰)^âˆ—$</span></li><li>Average across all sampled spin configurations</li></ol><p>Note that in typical presentations, the basis indices are not present as they are included in the sum/integral over position. However, because spin simulations can resolve basis-dependent correlations, we may as well keep them around for now. Neutron scattering experiments, however, cannot resolve basis-dependent correlations, instead seeing only:</p><p class="math-container">\[ğ’®^{Î±Î²}(ğª, Ï‰) = \sum_{j,k=1}^{B} e^{-i ğª â‹… (ğ_j - ğ_k)} ğ’®^{Î±Î²}_{jk}(ğª, Ï‰)\]</p><p>where <span>$B$</span> is the number of basis sites within the unit cell and <span>$ğ_j$</span> are the basis vectors. Within this page, we will refer to going from the full structure factor to this reduced form as performing the &quot;phase-weighted sum&quot; over basis sites.</p><p>The <em>static structure factor</em> is the spatial Fourier transform of the equal-time correlation function.</p><p class="math-container">\[ğ’®^{Î±Î²}_{jk}(ğª) = \sum_ğ« e^{-iğª â‹… ğ«} C^{Î±Î²}_{jk}(ğ«, 0)
               = \frac{1}{\sqrt{2Ï€}} \int dÏ‰ ğ’®^{Î±Î²}_{jk}(ğª, Ï‰)\]</p><p>For both of these structure factors, neutron scattering experiments also do not resolve individual spin components. Instead, the observed scattering intensity is proportional to the result of applying the neutron dipole factor:</p><p class="math-container">\[ğ’®(ğª, Ï‰) = âˆ‘_{Î±Î²} (Î´_{Î±Î²} - ğªÌ‚_Î± ğªÌ‚_Î²) ğ’®^{Î±Î²}(ğª, Ï‰)\]</p><h2 id="High-level-functions"><a class="docs-heading-anchor" href="#High-level-functions">High-level functions</a><a id="High-level-functions-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-functions" title="Permalink"></a></h2><p>Sunny exposes one main high-level function which performs the entirety of the steps (1)â€“(5) outlined above for you: <a href="../library/#Sunny.dynamic_structure_factor"><code>dynamic_structure_factor</code></a>. The documentation on that function provides a relatively in-depth explanation of all of the arguments.</p><p>A helper function <a href="../library/#Sunny.static_structure_factor"><code>static_structure_factor</code></a> also exists, which computes the static structure factor simply by calling <code>dynamic_structure_factor</code> with <code>num_meas=1</code>.</p><h2 id="Manual-incremental-updates"><a class="docs-heading-anchor" href="#Manual-incremental-updates">Manual incremental updates</a><a id="Manual-incremental-updates-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-incremental-updates" title="Permalink"></a></h2><p>If you are writing the lower-level simulation loop yourself, or have a stack of spin configurations on-hand that you want to compute the structure factor from, there is also an additional direct interface.</p><p>If you have a stack of snapshots on hand, then you can directly use them to  construct a <code>StructureFactor</code>. A &quot;stack of snapshots&quot; can either be represented as a <code>Vector{SpinSystem}</code> (all of which have the same underlying lattice), or a <code>Vector{Array{Vec3, 4}}</code> along with a <code>Crystal</code> defining the geometry.</p><pre><code class="language-julia hljs">sf = StructureFactor(spin_snaps; )</code></pre><p>All of the Fourier transforms and computation will be performed at construction time â€“ this may take considerable memory and time! By default, this will produce the static structure factor. To obtain the dynamic structure factor, set the <code>dyn_meas</code> keyword argument to a non-zero value (the number of time-evolved snapshots to Fourier transform), along with proper settings for <code>dynÎ”t</code> and <code>meas_rate</code> (the evolution timestep size, and how many timesteps are taken between snapshots). See the documentation of <a href="../library/#Sunny.StructureFactor"><code>StructureFactor</code></a> for more details.</p><p>Alternatively, you can create a <code>StructureFactor</code> at the beginning of your simulation by passing a single <code>SpinSystem</code>. The spin configuration of this first system does not enter the averaged structure factor, as the system is purely used to obtain information about the geometry.</p><p>Then, during the course of your simulation, call the <code>update!</code> function on the <code>StructureFactor</code> along with your <code>SpinSystem</code> â€“ the current spin configuration in the <code>SpinSystem</code> will be Fourier transformed and accumulated into the structure factor. A bare-bones loop achieving this (assuming that you&#39;ve already created a <code>system::SpinSystem</code> and a <code>sampler</code>) would look like:</p><pre><code class="language-julia hljs">sf = StructureFactor(system)
for _ in 1:therm_samples
   sample!(sampler)
   update!(sf, sys)
end</code></pre><p>(In fact, the code for <a href="../library/#Sunny.dynamic_structure_factor"><code>dynamic_structure_factor</code></a> is not much more complex than this!) At the end of the loop, <code>sf</code> will hold the structure factor, averaged across all of the thermal spin configurations it was provided.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../library/">Â« Library</a><a class="docs-footer-nextpage" href="../internals/">Internals Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Tuesday 12 October 2021 15:45">Tuesday 12 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
